version: '3'

tasks:
  upgrade:
    desc: Upgrade a Helm release
    env:
      HELM_VALUES_PATH:
        sh: echo "${HELM_VALUES_PATH:-values.yaml}"
    cmds:
      - if [ -z "${HELM_NAMESPACE}" ]; then echo "NAMESPACE var is not set"; exit 1; fi
      - if [ -z "${HELM_RELEASE}" ]; then echo "NAMESPACE var is not set"; exit 1; fi
      - if [ -z "${HELM_CHART}" ]; then echo "CHART var is not set"; exit 1; fi
      - if [ -z "${HELM_VALUES_PATH}" ]; then echo "VALUES_PATH var is not set"; exit 1; fi
      - helm upgrade -i -n ${HELM_NAMESPACE} --create-namespace -f ${HELM_VALUES_PATH} ${HELM_RELEASE} ${HELM_CHART}
